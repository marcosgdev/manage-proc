<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gest√£o de Acervo Processual</title>
    <link rel="stylesheet" href="main.css">
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="components.css">
    <link rel="stylesheet" href="auth.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <!-- Login Overlay -->
    <div id="loginOverlay">
        <div class="login-card">
            <div class="login-logo">
                <span style="font-size:2.8rem;">üìä</span>
                <h1>Sistema de Gest√£o Processual</h1>
            </div>
            <h2 id="loginTitle">Fa√ßa seu Login</h2>
            <p class="login-subtitle">Acesso ao sistema de controle processual</p>
            <div class="login-error" id="loginError"></div>

            <!-- Formul√°rio Login -->
            <form id="formLogin">
                <div class="login-group">
                    <label>Email</label>
                    <input type="email" id="loginEmail" placeholder="seu@email.com" required>
                </div>
                <div class="login-group">
                    <label>Senha</label>
                    <input type="password" id="loginSenha" placeholder="Sua senha" required>
                </div>
                <button type="submit" class="btn-login">Entrar</button>
            </form>

            <!-- Formul√°rio Cadastro (oculto por padr√£o) -->
            <form id="formSignup" style="display:none;">
                <div class="login-group">
                    <label>Email</label>
                    <input type="email" id="signupEmail" placeholder="seu@email.com" required>
                </div>
                <div class="login-group">
                    <label>Senha</label>
                    <input type="password" id="signupSenha" placeholder="M√≠nimo 6 caracteres" required minlength="6">
                </div>
                <button type="submit" class="btn-login">Cadastrar</button>
            </form>

            <div class="login-toggle">
                N√£o tem conta? <a id="linkCadastro">Cadastre-se</a>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <span class="logo-icon">üìä</span>
                    <h1>Sistema de Gest√£o Processual</h1>
                </div>
                <nav class="nav">
                    <button class="nav-btn active" data-section="dashboard">Dashboard</button>
                    <button class="nav-btn" data-section="processos">Processos</button>
                    <button class="nav-btn nav-restricted" data-section="equipe" data-tooltip="Dispon√≠vel apenas para Gestor">Equipe</button>
                    <button class="nav-btn" data-section="relatorios">Relat√≥rios</button>
                    <button class="nav-btn nav-restricted" data-section="usuarios" data-tooltip="Dispon√≠vel apenas para Gestor">Usu√°rios</button>
                </nav>
                <div class="user-profile">
                    <span class="user-name">Gestor</span>
                    <button class="logout-btn" id="logoutBtn">Sair</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Dashboard Section -->
        <section id="dashboard" class="section active">
            <div class="container">
                <div class="section-header">
                    <h2>Dashboard de Produtividade</h2>
                    <div class="filters">
                        <select id="filterPeriodo" class="filter-select">
                            <option value="7">√öltimos 7 dias</option>
                            <option value="30" selected>√öltimos 30 dias</option>
                            <option value="90">√öltimos 90 dias</option>
                            <option value="365">√öltimo ano</option>
                        </select>
                        <select id="filterUnidade" class="filter-select">
                            <option value="">Todas as Unidades</option>
                        </select>
                        <select id="filterTipoProcesso" class="filter-select">
                            <option value="">Todos os Tipos</option>
                        </select>
                        <select id="filterResponsavel" class="filter-select">
                            <option value="">Todos os Respons√°veis</option>
                        </select>
                    </div>
                </div>

                <!-- KPI Cards -->
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-icon">üìã</div>
                        <div class="kpi-content">
                            <h3>Processos em Andamento</h3>
                            <p class="kpi-value" id="kpiAndamento">0</p>
                            <span class="kpi-subtitle">Total ativo</span>
                        </div>
                    </div>

                    <div class="kpi-card">
                        <div class="kpi-icon">‚úÖ</div>
                        <div class="kpi-content">
                            <h3>Processos Finalizados</h3>
                            <p class="kpi-value" id="kpiFinalizados">0</p>
                            <span class="kpi-subtitle">√öltimo m√™s</span>
                        </div>
                    </div>

                    <div class="kpi-card">
                        <div class="kpi-icon">‚è±Ô∏è</div>
                        <div class="kpi-content">
                            <h3>Tempo M√©dio</h3>
                            <p class="kpi-value" id="kpiTempoMedio">0</p>
                            <span class="kpi-subtitle">Dias para conclus√£o</span>
                        </div>
                    </div>

                    <div class="kpi-card">
                        <div class="kpi-icon">üë•</div>
                        <div class="kpi-content">
                            <h3>Equipe Ativa</h3>
                            <p class="kpi-value" id="kpiEquipe">0</p>
                            <span class="kpi-subtitle">Colaboradores</span>
                        </div>
                    </div>
                </div>

                <!-- Charts Row 1 -->
                <div class="charts-row">
                    <div class="chart-card">
                        <h3>Processos por Tipo de Cota√ß√£o</h3>
                        <canvas id="chartTipoCotacao"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Processos por Status</h3>
                        <canvas id="chartStatus"></canvas>
                    </div>
                </div>

                <!-- Charts Row 2 -->
                <div class="charts-row">
                    <div class="chart-card chart-full">
                        <h3>Evolu√ß√£o de Processos ao Longo do Tempo</h3>
                        <canvas id="chartEvolucao"></canvas>
                    </div>
                </div>

                <!-- Charts Row 3 -->
                <div class="charts-row">
                    <div class="chart-card">
                        <h3>Produtividade por Respons√°vel</h3>
                        <canvas id="chartProdutividade"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Complexidade dos Processos</h3>
                        <canvas id="chartComplexidade"></canvas>
                    </div>
                </div>

                <!-- Processos Cr√≠ticos -->
                <div class="alert-section">
                    <h3>‚ö†Ô∏è Processos Cr√≠ticos (Pr√≥ximos do Prazo)</h3>
                    <div id="processosCriticos" class="processos-criticos-list"></div>
                </div>

                <!-- Produtividade Mensal da Equipe -->
                <div class="productivity-section" id="produtividadeMensal" style="display:block !important; background:#ffffff; border-radius:12px; padding:24px; margin-top:24px; border:1px solid #e2e8f0; box-shadow:0 4px 6px -1px rgba(0,0,0,0.1);">
                    <div class="productivity-header" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; flex-wrap:wrap; gap:12px;">
                        <h3 style="font-size:1.25rem; font-weight:600; margin:0; color:#1e293b;">üìä Produtividade Mensal da Equipe</h3>
                        <div class="productivity-filters">
                            <select id="filterAno" class="filter-select">
                                <!-- Populado via JS -->
                            </select>
                            <select id="filterMembro" class="filter-select">
                                <option value="">Todos os Membros</option>
                            </select>
                        </div>
                    </div>
                    <div class="productivity-table-container">
                        <table class="productivity-table" id="tabelaProdutividadeMensal">
                            <thead>
                                <tr>
                                    <th>Membro</th>
                                    <th>Jan</th>
                                    <th>Fev</th>
                                    <th>Mar</th>
                                    <th>Abr</th>
                                    <th>Mai</th>
                                    <th>Jun</th>
                                    <th>Jul</th>
                                    <th>Ago</th>
                                    <th>Set</th>
                                    <th>Out</th>
                                    <th>Nov</th>
                                    <th>Dez</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody id="tbodyProdutividade">
                                <!-- Populado via JS -->
                            </tbody>
                        </table>
                    </div>
                    <div class="productivity-legend">
                        <span class="legend-item"><span class="legend-color bg-success"></span> Finalizados</span>
                        <span class="legend-item"><span class="legend-color bg-primary"></span> Em andamento</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Processos Section -->
        <section id="processos" class="section">
            <div class="container">
                <div class="section-header">
                    <h2>Gest√£o de Processos</h2>
                    <button class="btn-primary gestor-only" id="btnNovoProcesso">+ Novo Processo</button>
                </div>

                <div class="tabs">
                    <button class="tab-btn active" data-tab="andamento">Em Andamento</button>
                    <button class="tab-btn" data-tab="finalizados">Finalizados</button>
                </div>

                <div class="search-filters">
                    <input type="text" id="searchProcesso" class="search-input" placeholder="Buscar por SIGADOC, descri√ß√£o ou respons√°vel...">
                    <select id="filterTipoCotacao" class="filter-select">
                        <option value="">Todos os Tipos</option>
                    </select>
                    <select id="filterResponsavel" class="filter-select">
                        <option value="">Todos os Respons√°veis</option>
                    </select>
                </div>

                <div id="andamento" class="tab-content active">
                    <div id="processosAndamentoTable" class="table-container"></div>
                </div>

                <div id="finalizados" class="tab-content">
                    <div id="processosFinalizadosTable" class="table-container"></div>
                </div>
            </div>
        </section>

        <!-- Equipe Section -->
        <section id="equipe" class="section">
            <div class="container">
                <div class="section-header">
                    <h2>Gest√£o de Equipe</h2>
                    <button class="btn-primary gestor-only" id="btnNovoFuncionario">+ Adicionar Membro</button>
                </div>

                <div class="team-grid" id="teamGrid"></div>

                <div class="team-performance">
                    <h3>Performance Individual</h3>
                    <div id="performanceTable" class="table-container"></div>
                </div>
            </div>
        </section>

        <!-- Relat√≥rios Section -->
        <section id="relatorios" class="section">
            <div class="container">
                <div class="section-header">
                    <h2>Relat√≥rios e An√°lises</h2>
                    <div class="header-actions">
                        <button class="btn-secondary" id="btnExportarRelatorio">üì• Exportar CSV</button>
                        <button class="btn-primary" id="btnExportarPDF">üìÑ Exportar PDF</button>
                    </div>
                </div>

                <div class="report-filters">
                    <label>
                        Per√≠odo:
                        <input type="date" id="reportDateStart" class="input-date">
                    </label>
                    <label>
                        at√©
                        <input type="date" id="reportDateEnd" class="input-date">
                    </label>
                    <button class="btn-secondary" id="btnGerarRelatorio">Gerar Relat√≥rio</button>
                </div>

                <!-- Se√ß√£o de IA -->
                <div class="ia-section">
                    <div class="ia-header">
                        <h3>An√°lise com Intelig√™ncia Artificial</h3>
                        <div class="ia-actions">
                            <button class="btn-ia" id="btnResumoIA" title="Gerar resumo executivo com IA">
                                ü§ñ Gerar Resumo IA
                            </button>
                            <button class="btn-ia-config" id="btnConfigurarIA" title="Configurar API Key da OpenAI">
                                ‚öôÔ∏è
                            </button>
                        </div>
                    </div>
                    <div id="resumoIAContainer" class="hidden"></div>
                </div>

                <div class="report-summary" id="reportSummary"></div>

                <div class="charts-row">
                    <div class="chart-card">
                        <h3>An√°lise por Unidade Executora</h3>
                        <canvas id="chartUnidade"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Tipos de Objeto</h3>
                        <canvas id="chartTipoObjeto"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Usu√°rios Section -->
        <section id="usuarios" class="section">
            <div class="container">
                <div class="section-header">
                    <h2>Gerenciamento de Usu√°rios</h2>
                </div>
                <div id="usuariosTable" class="table-container"></div>

                <!-- Configura√ß√µes de Email -->
                <div class="settings-card gestor-only" style="margin-top: 30px;">
                    <div class="settings-header">
                        <h3>Configura√ß√µes de Notifica√ß√µes por Email</h3>
                        <span id="emailStatus" class="status-badge status-inactive">N√£o configurado</span>
                    </div>
                    <p class="settings-description">
                        Configure o EmailJS para enviar notifica√ß√µes autom√°ticas sobre novos processos,
                        alertas de prazo (5 dias e 1 dia) e finaliza√ß√µes.
                    </p>
                    <div class="settings-actions">
                        <button class="btn-secondary" id="btnConfigurarEmail">Configurar EmailJS</button>
                        <button class="btn-secondary" id="btnTestarEmail" disabled>Testar Envio</button>
                    </div>
                    <div class="settings-info">
                        <small>
                            Crie uma conta gratuita em <a href="https://www.emailjs.com/" target="_blank">emailjs.com</a>
                            e configure os templates de email.
                        </small>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal para Novo Processo -->
    <div id="modalProcesso" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h2 id="modalTitle">Novo Processo</h2>
            <form id="formProcesso">
                <div class="form-grid">
                    <div class="form-group">
                        <label>N√∫mero do Processo*</label>
                        <input type="text" id="inputSigadoc" required>
                    </div>
                    <div class="form-group">
                        <label>Link</label>
                        <input type="url" id="inputLink">
                    </div>
                    <div class="form-group">
                        <label>Data In√≠cio*</label>
                        <input type="date" id="inputDataInicio" required>
                    </div>
                    <div class="form-group">
                        <label>Prazo Final</label>
                        <input type="date" id="inputDataFinal">
                    </div>
                    <div class="form-group">
                        <label>Tipo de Cota√ß√£o*</label>
                        <select id="inputTipoCotacao" required></select>
                    </div>
                    <div class="form-group">
                        <label>Tipo de Objeto*</label>
                        <select id="inputTipoObjeto" required></select>
                    </div>
                    <div class="form-group form-full">
                        <label>Descri√ß√£o*</label>
                        <textarea id="inputDescricao" required></textarea>
                    </div>
                    <div class="form-group">
                        <label>Respons√°vel*</label>
                        <select id="inputResponsavel" required></select>
                    </div>
                    <div class="form-group">
                        <label>Grau de Complexidade*</label>
                        <select id="inputComplexidade" required>
                            <option value="BAIXO">Baixo</option>
                            <option value="M√âDIO">M√©dio</option>
                            <option value="ALTO">Alto</option>
                            <option value="MUITO ALTO">Muito Alto</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Quantidade de Itens*</label>
                        <input type="number" id="inputQuantidadeItens" min="1" required>
                    </div>
                    <div class="form-group">
                        <label>Unidade Executora*</label>
                        <select id="inputUnidadeExecutora" required></select>
                    </div>
                    <div class="form-group">
                        <label>Status*</label>
                        <select id="inputStatus" required></select>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" id="btnCancelar">Cancelar</button>
                    <button type="submit" class="btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Funcion√°rio -->
    <div id="modalFuncionario" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h2>Adicionar Membro da Equipe</h2>
            <form id="formFuncionario">
                <div class="form-group">
                    <label>Nome*</label>
                    <input type="text" id="inputNome" required>
                </div>
                <div class="form-group">
                    <label>Contato (Email)*</label>
                    <input type="email" id="inputContato" required>
                </div>
                <div class="form-group">
                    <label>V√≠nculo*</label>
                    <select id="inputVinculo" required>
                        <option value="Colaborador">Colaborador</option>
                        <option value="Servidor">Servidor</option>
                        <option value="Estagi√°rio">Estagi√°rio</option>
                        <option value="Terceirizado">Terceirizado</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" id="btnCancelarFunc">Cancelar</button>
                    <button type="submit" class="btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Configura√ß√£o de Email -->
    <div id="modalEmail" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h2>Configurar Notifica√ß√µes por Email</h2>
            <form id="formEmail">
                <div class="form-section">
                    <h4>Credenciais do EmailJS</h4>
                    <p class="form-help">Obtenha essas informa√ß√µes no painel do <a href="https://dashboard.emailjs.com/" target="_blank">EmailJS</a>.</p>
                    <div class="form-group">
                        <label>Service ID*</label>
                        <input type="text" id="inputEmailServiceId" placeholder="service_xxxxxxx" required>
                    </div>
                    <div class="form-group">
                        <label>Public Key*</label>
                        <input type="text" id="inputEmailPublicKey" placeholder="user_xxxxxxxxxxxxxxx" required>
                    </div>
                </div>
                <div class="form-section">
                    <h4>Template Universal</h4>
                    <p class="form-help">Use apenas 1 template para todas as notifica√ß√µes (compat√≠vel com plano gratuito).</p>
                    <div class="form-group">
                        <label>Template ID*</label>
                        <input type="text" id="inputTemplateId" placeholder="template_xxxxxxx" required>
                        <small>Vari√°veis: tipo_notificacao, assunto, mensagem_principal, numero_processo, descricao, tipo_cotacao, responsavel, data_info, prazo_info, unidade, info_extra, link_sistema, to_email</small>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" id="btnCancelarEmail">Cancelar</button>
                    <button type="button" class="btn-danger" id="btnLimparEmail">Limpar Configura√ß√£o</button>
                    <button type="submit" class="btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner"></div>
        <p>Carregando...</p>
    </div>

    <!-- jsPDF para exporta√ß√£o de PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.1/jspdf.plugin.autotable.min.js"></script>

    <!-- EmailJS para notifica√ß√µes por email -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        import { getAuth } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        // Configura√ß√£o do Firebase (SUBSTITUA COM SUAS CREDENCIAIS)
        const firebaseConfig = {
            apiKey: "AIzaSyCzfIPSXww8X04jyqPLVlyixLFYU_DrHvM",
            authDomain: "manager-proc.firebaseapp.com",
            databaseURL: "https://manager-proc-default-rtdb.firebaseio.com",
            projectId: "manager-proc",
            storageBucket: "manager-proc.firebasestorage.app",
            messagingSenderId: "1096563005192",
            appId: "1:1096563005192:web:807d6042b782726cbe7ebd"
        };

        const app = initializeApp(firebaseConfig);
        window.database = getDatabase(app);
        window.auth = getAuth(app);
    </script>

    <!-- Scripts da Aplica√ß√£o -->
    <script type="module" src="auth.js"></script>
    <script type="module" src="login.js"></script>
    <script type="module" src="config.js"></script>
    <script type="module" src="database.js"></script>
    <script type="module" src="utils.js"></script>
    <script type="module" src="charts.js"></script>
    <script type="module" src="openai.js"></script>
    <script type="module" src="email.js"></script>
    <script type="module" src="processos.js"></script>
    <script type="module" src="equipe.js"></script>
    <script type="module" src="relatorios.js"></script>
    <script type="module" src="dashboard.js"></script>
    <script type="module" src="app.js"></script>
</body>
</html>
